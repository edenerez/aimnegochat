extends layout
block title
  title#title Chat Room 
block body
  script(src='/javascripts/yahoo_yui_2.8.1/yahoo-dom-event/yahoo-dom-event.js')
  script(src='/javascripts/yahoo_yui_2.8.1/element/element-min.js')
  script(src='/javascripts/yahoo_yui_2.8.1/datasource/datasource-min.js')
  script(src='/javascripts/yahoo_yui_2.8.1/datatable/datatable-min.js')
  script(src='/javascripts/datatable.js')
  if (!locals.preview)
    script(src='/socket.io/socket.io.js')
    script(src='/javascripts/RoomForNegoChat.js')

  div#mainPanel
    if (locals.preview)
      div.mainSection#previewNoteRow PLEASE NOTE: this research study requires that you read the entire description of the setting, correctly answer a few questions based on the description and then <b>wait for another person to join</b>. Otherwise you will not receive the money.
      div.mainSection#previewNoteRow Additionally, you are not allowed to this experiment more than once. If you do it more than once, you will only receive a single payment. 
        // b A bonus will be given based on how good your agreement is
    div.mainSection#mainStatusRow <!-- row #2: status and buttons -->
      table
        tr
          td Your role: <b id='role'>#{role}</b>.
          td#phase
            span.value Status: #{locals.preview? "This is a preview only!": "Connecting..."}
          td#remainingTime
            span.key Remaining time:
            span.value
          td
            button#btnUtility Your scores
          td
            button#btnOppUtility Partner's scores

    if (agent)
     div.mainSection <!-- row #3: explanations to the user; possible values and utils -->
      if gametype=='negochat'
       div Use the menus below as a draft, to track the issues you agreed so far.
       div This draft is <b>not binding</b> until both of you sign it.
       div &nbsp;  
       include GeniusMenus
       div
        button(id='signAgreement',disabled='disabled',title="The sign button is enabled only when your draft is consistent with your partner's draft on all issues") Sign the agreement
      if gametype=='chat'
       include GeniusIssuesAndValues

    div#mainChatRow.mainSection <!-- row #4: chat -->
      p <b>Please write a complete, grammatically correct English sentence.</b>
      p 
        input#chatMessage(value="hi")
        button#btnSendChat Say

    div.mainSection#mainHistoryRow.yui-skin-sam <!-- row #5: history -->
      table#tblhistory
        thead
          tr
            th(align="center",width="100%") History of actions
        tbody
          tr
            td(valign="top",align="center",style="font-size: 8pt;")
              div#tblHistoryContainer"
  
    div#mainOptOutRow.mainSection <!-- row #6: opt-out -->
      p 
       b Click here to quit the negotiation without an agreement:
       button#btnOptOut Opt Out

    form#nextAction(action="#{next_action}",method="get",style='display:none')

